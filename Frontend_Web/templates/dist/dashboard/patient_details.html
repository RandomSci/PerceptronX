<!DOCTYPE html>
<html lang="en">
<head>
  <title>Patient Details | APR-CV</title>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="APR-CV Patient Management System">
  <meta name="keywords" content="physical therapy, rehab, cardiovascular therapy, patient management">
  <meta name="author" content="APR-CV">
  
  
  <link rel="icon" href="../static/assets/images/favicon.svg" type="image/x-icon">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" id="main-font-link">
  
  <link rel="stylesheet" href="../static/assets/fonts/tabler-icons.min.css" >
  
  <link rel="stylesheet" href="../static/assets/fonts/feather.css" >
  
  <link rel="stylesheet" href="../static/assets/fonts/fontawesome.css" >
  
  <link rel="stylesheet" href="../static/assets/fonts/material.css" >
  
  <link rel="stylesheet" href="../static/assets/css/style.css" id="main-style-link" >
  <link rel="stylesheet" href="../static/assets/css/style-preset.css" >
</head>

<body data-pc-preset="preset-1" data-pc-direction="ltr" data-pc-theme="light">
  
  <div class="loader-bg">
    <div class="loader-track">
      <div class="loader-fill"></div>
    </div>
  </div>
  
  
  
  <nav class="pc-sidebar">
    <div class="navbar-wrapper">
      <div class="m-header">
        <a href="/front-page" class="b-brand text-primary">
          <i class="ti ti-medical-cross fs-4"></i>
          <span class="ms-2 fw-bold">APR-CV</span>
        </a>
      </div>
      <div class="navbar-content">
        <ul class="pc-navbar">
          <li class="pc-item">
            <a href="/front-page" class="pc-link">
              <span class="pc-micon"><i class="ti ti-dashboard"></i></span>
              <span class="pc-mtext">Dashboard</span>
            </a>
          </li>
        
          <li class="pc-item pc-hasmenu active">
            <a href="#!" class="pc-link">
              <span class="pc-micon"><i class="ti ti-users"></i></span>
              <span class="pc-mtext">Patients</span>
              <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
            </a>
            <ul class="pc-submenu">
              <li class="pc-item"><a class="pc-link" href="/patients">Patient Directory</a></li>
              <li class="pc-item"><a class="pc-link" href="/patients/add">Add New Patient</a></li>
              <li class="pc-item"><a class="pc-link" href="/reports/patients">Patient Reports</a></li>
            </ul>
          </li>
        
          <li class="pc-item pc-hasmenu">
            <a href="#!" class="pc-link">
              <span class="pc-micon"><i class="ti ti-calendar"></i></span>
              <span class="pc-mtext">Appointments</span>
              <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
            </a>
            <ul class="pc-submenu">
              <li class="pc-item"><a class="pc-link" href="/appointments">Schedule</a></li>
              <li class="pc-item"><a class="pc-link" href="/appointments/new">New Appointment</a></li>
            </ul>
          </li>
        
          <li class="pc-item pc-hasmenu">
            <a href="#!" class="pc-link">
              <span class="pc-micon"><i class="ti ti-activity"></i></span>
              <span class="pc-mtext">Exercise Library</span>
              <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
            </a>
            <ul class="pc-submenu">
              <li class="pc-item"><a class="pc-link" href="/exercises">Browse Exercises</a></li>
              <li class="pc-item"><a class="pc-link" href="/exercises/add">Upload New Exercise</a></li>
            </ul>
          </li>
        
          <li class="pc-item pc-hasmenu">
            <a href="#!" class="pc-link">
              <span class="pc-micon"><i class="ti ti-report"></i></span>
              <span class="pc-mtext">Treatment Plans</span>
              <span class="pc-arrow"><i data-feather="chevron-right"></i></span>
            </a>
            <ul class="pc-submenu">
              <li class="pc-item"><a class="pc-link" href="/treatment-plans/new">Create Plan</a></li>
              <li class="pc-item"><a class="pc-link" href="/treatment-plans">Manage Plans</a></li>
            </ul>
          </li>
        
          <li class="pc-item">
            <a href="/analytics" class="pc-link">
              <span class="pc-micon"><i class="ti ti-chart-bar"></i></span>
              <span class="pc-mtext">Analytics</span>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  
  
  
  <header class="pc-header">
    <div class="header-wrapper">
      
      <div class="me-auto pc-mob-drp">
        <ul class="list-unstyled">
          <li class="pc-h-item pc-sidebar-collapse">
            <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
              <i class="ti ti-menu-2"></i>
            </a>
          </li>
          <li class="pc-h-item pc-sidebar-popup">
            <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
              <i class="ti ti-menu-2"></i>
            </a>
          </li>
          <li class="pc-h-item d-none d-md-inline-flex">
            <form class="header-search">
              <i data-feather="search" class="icon-search"></i>
              <input type="search" class="form-control" placeholder="Search...">
            </form>
          </li>
        </ul>
      </div>
      
      
      <div class="ms-auto">
        <ul class="list-unstyled">
          <li class="dropdown pc-h-item header-user-profile">
            <a class="pc-head-link dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" data-bs-auto-close="outside" aria-expanded="false">
              <img src="/static/assets/images/user/therapist_11_1744631888.gif" alt="user-image" class="user-avtar">
              <span>{{ first_name }} {{ last_name }}</span>
            </a>
            <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown">
              <div class="dropdown-header">
                <div class="d-flex mb-1">
                  <div class="flex-shrink-0">
                    <img src="/static/assets/images/user/therapist_11_1744631888.gif" alt="user-image" class="user-avtar wid-35">
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <h6 class="mb-1">{{ first_name }} {{ last_name }}</h6>
                    <span>Physical Therapist</span>
                  </div>
                  <a href="/logout" class="pc-head-link bg-transparent"><i class="ti ti-power text-danger"></i></a>
                </div>
              </div>
              
              <a href="/logout" class="dropdown-item">
                <i class="ti ti-power"></i>
                <span>Logout</span>
              </a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </header>
  

  
  <div class="pc-container">
    <div class="pc-content">
      
      <div class="page-header">
        <div class="page-block">
          <div class="row align-items-center">
            <div class="col-md-12">
              <div class="page-header-title">
                <h5 class="mb-0">{{ patient.first_name }} {{ patient.last_name }}</h5>
              </div>
              <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="/front-page">Home</a></li>
                <li class="breadcrumb-item"><a href="/patients">Patients</a></li>
                <li class="breadcrumb-item active">Patient Details</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      

      <div class="row">
        
        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h5>Patient Information</h5>
            </div>
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="avatar">
                  <div class="avatar-initial rounded bg-primary">
                    <i class="ti ti-user f-24"></i>
                  </div>
                </div>
                <div class="ms-3">
                  <h5 class="mb-0">{{ patient.first_name }} {{ patient.last_name }}</h5>
                  <p class="text-muted mb-0">Patient ID: PT-{{ patient.patient_id }}</p>
                </div>
              </div>
              <div class="mb-3">
                <span class="badge bg-light-primary mb-1">
                  <i class="ti ti-stethoscope"></i> {{ patient.diagnosis if patient.diagnosis else 'No diagnosis' }}
                </span>
              </div>
              <hr>
              <div class="row">
                <div class="col-12 mb-3">
                  <p class="mb-1"><i class="ti ti-mail me-2 text-muted"></i> {{ patient.email if patient.email else 'No email' }}</p>
                  <p class="mb-1"><i class="ti ti-phone me-2 text-muted"></i> {{ patient.phone if patient.phone else 'No phone' }}</p>
                  <p class="mb-1"><i class="ti ti-calendar me-2 text-muted"></i> DOB: {{ patient.date_of_birth if patient.date_of_birth else 'Not provided' }}</p>
                  <p class="mb-1"><i class="ti ti-map-pin me-2 text-muted"></i> {{ patient.address if patient.address else 'No address' }}</p>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <a href="/patients/{{ patient.patient_id }}/edit" class="btn btn-primary">
                    <i class="ti ti-edit me-1"></i> Edit Profile
                  </a>
                  <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addMetricsModal">
                    <i class="ti ti-plus me-1"></i> Add Metrics
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5>Notes</h5>
              <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addNoteModal">
                <i class="ti ti-plus"></i> Add Note
              </button>
            </div>
            <div class="card-body">
              <div class="note-box p-3 mb-2 bg-light rounded">
                <p class="mb-1">{{ patient.notes if patient.notes else 'No notes available for this patient.' }}</p>
              </div>
            </div>
          </div>
        </div>
        
        
        <div class="col-md-8">
          <div class="card">
            <div class="card-header pb-0">
              <ul class="nav nav-tabs nav-tabs-line" id="patientTab" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" id="treatment-tab" data-bs-toggle="tab" href="#treatment" role="tab" aria-controls="treatment" aria-selected="true">
                    <i class="ti ti-report me-2"></i>Treatment Plans
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="appointments-tab" data-bs-toggle="tab" href="#appointments" role="tab" aria-controls="appointments" aria-selected="false">
                    <i class="ti ti-calendar me-2"></i>Appointments
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" id="metrics-tab" data-bs-toggle="tab" href="#metrics" role="tab" aria-controls="metrics" aria-selected="false">
                    <i class="ti ti-chart-line me-2"></i>Metrics
                  </a>
                </li>
              </ul>
            </div>
            <div class="card-body">
              <div class="tab-content" id="patientTabContent">
                
                <div class="tab-pane fade show active" id="treatment" role="tabpanel" aria-labelledby="treatment-tab">
                  <div class="d-flex justify-content-between mb-3">
                    <h5 class="mb-0">Current Treatment Plans</h5>
                    <a href="/treatment-plans/new?patient_id={{ patient.patient_id }}" class="btn btn-primary">
                      <i class="ti ti-plus me-1"></i> New Plan
                    </a>
                  </div>
                  
                  {% if treatment_plans %}
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Plan Name</th>
                          <th>Start Date</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for plan in treatment_plans %}
                        <tr>
                          <td>{{ plan.name }}</td>
                          <td>{{ plan.created_at.strftime('%Y-%m-%d') }}</td>
                          <td>
                            {% if plan.status == 'active' %}
                            <span class="badge bg-success">Active</span>
                            {% elif plan.status == 'completed' %}
                            <span class="badge bg-info">Completed</span>
                            {% else %}
                            <span class="badge bg-warning">{{ plan.status }}</span>
                            {% endif %}
                          </td>
                          <td>
                            <div class="btn-group" role="group">
                              <a href="/treatment-plans" class="btn btn-sm btn-outline-primary">View</a>
                              <a href="/treatment-plans/{{ plan.plan_id }}/edit" class="btn btn-sm btn-outline-secondary">Edit</a>
                            </div>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  {% else %}
                  <div class="text-center py-4">
                    <i class="ti ti-report-off f-40 text-muted"></i>
                    <h5 class="mt-3">No Treatment Plans</h5>
                    <p>This patient doesn't have any treatment plans yet.</p>
                    <a href="/treatment-plans/new?patient_id={{ patient.patient_id }}" class="btn btn-primary">
                      Create First Plan
                    </a>
                  </div>
                  {% endif %}
                </div>
                
                
                <div class="tab-pane fade" id="appointments" role="tabpanel" aria-labelledby="appointments-tab">
                  <div class="d-flex justify-content-between mb-3">
                    <h5 class="mb-0">Appointment History</h5>
                    <a href="/appointments/new?patient_id={{ patient.patient_id }}" class="btn btn-primary">
                      <i class="ti ti-plus me-1"></i> Schedule
                    </a>
                  </div>
                  
                  {% if appointments %}
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>Time</th>
                          <th>Duration</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for appointment in appointments %}
                        <tr>
                          <td>{{ appointment.appointment_date.strftime('%Y-%m-%d') }}</td>
                          <td>{{ appointment.appointment_time }}</td>
                          <td>{{ appointment.duration }} min</td>
                          <td>
                            {% if appointment.appointment_date < today %}
                            <span class="badge bg-secondary">Past</span>
                            {% else %}
                            <span class="badge bg-primary">Upcoming</span>
                            {% endif %}
                          </td>
                          <td>
                            <div class="btn-group" role="group">
                              <button data-appointment-id="{{ appointment.appointment_id }}" class="btn btn-sm btn-outline-primary view-appointment">Details</button>
                              {% if appointment.appointment_date >= today %}
                              <a href="/appointments/{{ appointment.appointment_id }}/edit" class="btn btn-sm btn-outline-secondary">Edit</a>
                              {% endif %}
                            </div>
                          </td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  {% else %}
                  <div class="text-center py-4">
                    <i class="ti ti-calendar-off f-40 text-muted"></i>
                    <h5 class="mt-3">No Appointments</h5>
                    <p>This patient doesn't have any appointments scheduled.</p>
                    <a href="/appointments/new?patient_id={{ patient.patient_id }}" class="btn btn-primary">
                      Schedule First Appointment
                    </a>
                  </div>
                  {% endif %}
                </div>
                
                
                <div class="tab-pane fade" id="metrics" role="tabpanel" aria-labelledby="metrics-tab">
                  <div class="d-flex justify-content-between mb-3">
                    <h5 class="mb-0">Patient Metrics</h5>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMetricsModal">
                      <i class="ti ti-plus me-1"></i> Add Metrics
                    </button>
                  </div>
                  
                  {% if metrics %}
                  <div class="card mb-3">
                    <div class="card-body">
                      <div class="chart-container" style="position: relative; height:300px;">
                        <canvas id="metricsChart"></canvas>
                      </div>
                    </div>
                  </div>
                  
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Date</th>
                          <th>Metric Type</th>
                          <th>Value</th>
                          <th>Notes</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for metric in metrics %}
                        <tr>
                          <td>{{ metric.measurement_date.strftime('%Y-%m-%d') }}</td>
                          <td>{{ metric.metric_type }}</td>
                          <td>{{ metric.value }}{% if metric.unit %} {{ metric.unit }}{% endif %}</td>
                          <td>{{ metric.notes if metric.notes else '-' }}</td>
                        </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                  {% else %}
                  <div class="text-center py-4">
                    <i class="ti ti-chart-bar-off f-40 text-muted"></i>
                    <h5 class="mt-3">No Metrics Recorded</h5>
                    <p>Start tracking patient progress by adding metrics.</p>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addMetricsModal">
                      Record First Metrics
                    </button>
                  </div>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  

  
  <div class="modal fade" id="addNoteModal" tabindex="-1" role="dialog" aria-labelledby="addNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addNoteModalLabel">Add Note</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/patients/{{ patient.patient_id }}/notes" method="post">
          <div class="modal-body">
            <div class="form-group">
              <label for="note-content">Note</label>
              <textarea class="form-control" id="note-content" name="notes" rows="4" required></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Note</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  
  <div class="modal fade" id="addMetricsModal" tabindex="-1" role="dialog" aria-labelledby="addMetricsModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="addMetricsModalLabel">Record Patient Metrics</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form action="/patients/{{ patient.patient_id }}/metrics" method="post">
          <div class="modal-body">
            <div class="mb-3">
              <label for="metric-type" class="form-label">Metric Type</label>
              <select class="form-select" id="metric-type" name="metric_type" required>
                <option value="" selected disabled>Select a metric type</option>
                <option value="blood_pressure">Blood Pressure</option>
                <option value="heart_rate">Heart Rate</option>
                <option value="pain_level">Pain Level</option>
                <option value="range_of_motion">Range of Motion</option>
                <option value="weight">Weight</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="metric-value" class="form-label">Value</label>
                <input type="text" class="form-control" id="metric-value" name="value" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="metric-unit" class="form-label">Unit</label>
                <input type="text" class="form-control" id="metric-unit" name="unit">
              </div>
            </div>
            <div class="mb-3">
              <label for="measurement-date" class="form-label">Date</label>
              <input type="date" class="form-control" id="measurement-date" name="measurement_date" required value="{{ today }}">
            </div>
            <div class="mb-3">
              <label for="metric-notes" class="form-label">Notes</label>
              <textarea class="form-control" id="metric-notes" name="notes" rows="2"></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Metrics</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  
  <div class="modal fade" id="viewAppointmentModal" tabindex="-1" role="dialog" aria-labelledby="viewAppointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewAppointmentModalLabel">Appointment Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <h6>Date & Time</h6>
            <p id="appointment-datetime"></p>
          </div>
          <div class="mb-3">
            <h6>Duration</h6>
            <p id="appointment-duration"></p>
          </div>
          <div class="mb-3">
            <h6>Notes</h6>
            <p id="appointment-notes">No notes available</p>
          </div>
          <div class="mb-3">
            <h6>Status</h6>
            <p id="appointment-status"></p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <a href="#" id="edit-appointment-link" class="btn btn-primary">Edit</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="pc-footer">
    <div class="footer-wrapper container-fluid">
      <div class="row">
        <div class="col-auto my-1">
          <span>&copy; 2025 APR-CV Physical Therapy</span>
        </div>
      </div>
    </div>
  </footer>


<script src="../static/assets/js/plugins/popper.min.js"></script>
<script src="../static/assets/js/plugins/perfect-scrollbar.min.js"></script>
<script src="../static/assets/js/plugins/bootstrap.min.js"></script>
<script src="../static/assets/js/pcoded.js"></script>
<script src="../static/assets/js/plugins/feather.min.js"></script>


<script src="../static/assets/js/plugins/chart.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {

  {% if metrics %}
  var ctx = document.getElementById('metricsChart').getContext('2d');
  var metricsChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [{% for metric in metrics %}'{{ metric.measurement_date.strftime("%Y-%m-%d") }}'{% if not loop.last %}, {% endif %}{% endfor %}],
      datasets: [{
        label: '{{ metrics[0].metric_type if metrics }}',
        data: [{% for metric in metrics %}{{ metric.value }}{% if not loop.last %}, {% endif %}{% endfor %}],
        borderColor: 'rgba(75, 192, 192, 1)',
        backgroundColor: 'rgba(75, 192, 192, 0.2)',
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });
  {% endif %}


  const viewButtons = document.querySelectorAll('.view-appointment');
  viewButtons.forEach(button => {
    button.addEventListener('click', function() {
      const appointmentId = this.getAttribute('data-appointment-id');


      

      {% if appointments %}
      const appointments = [
        {% for appointment in appointments %}
        {
          id: '{{ appointment.appointment_id }}',
          date: '{{ appointment.appointment_date.strftime("%Y-%m-%d") }}',
          time: '{{ appointment.appointment_time }}',
          duration: '{{ appointment.duration }}',
          notes: '{{ appointment.notes if appointment.notes else "No notes available" }}',
          status: '{{ "Past" if appointment.appointment_date < today else "Upcoming" }}'
        }{% if not loop.last %},{% endif %}
        {% endfor %}
      ];
      
      const appointment = appointments.find(a => a.id === appointmentId);
      if (appointment) {
        document.getElementById('appointment-datetime').textContent = appointment.date + ' at ' + appointment.time;
        document.getElementById('appointment-duration').textContent = appointment.duration + ' minutes';
        document.getElementById('appointment-notes').textContent = appointment.notes;
        document.getElementById('appointment-status').textContent = appointment.status;
        
        const editLink = document.getElementById('edit-appointment-link');
        if (appointment.status === 'Upcoming') {
          editLink.style.display = 'block';
          editLink.href = '/appointments/' + appointmentId + '/edit';
        } else {
          editLink.style.display = 'none';
        }
        
        const modal = new bootstrap.Modal(document.getElementById('viewAppointmentModal'));
        modal.show();
      }
      {% endif %}
    });
  });
});
</script>
</body>
</html>